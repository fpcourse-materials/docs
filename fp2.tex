%! suppress = Ellipsis
%! suppress = Quote
%! suppress = LineBreak
%! suppress = Makeatletter
%! suppress = TooLargeSection
%! suppress = MissingLabel
\documentclass[12pt]{article}

% Fields
\usepackage{geometry}
\geometry{top=25mm}
\geometry{bottom=35mm}
\geometry{left=20mm}
\geometry{right=20mm}
% ------------------------------------------------

% Graphics
\usepackage{color}
\usepackage{tabularx}
\usepackage{tikz}
% https://tikz.dev/tikz-graphs
\usetikzlibrary{positioning, shapes.geometric, arrows, automata, graphs}
\tikzset{
    expr/.style={ellipse, draw=gray!60, fill=gray!5, very thick, minimum size=7mm, yshift=0.7cm},
    hexpr/.style={ellipse, draw=gray!60, fill=blue!15, very thick, minimum size=7mm, yshift=0.7cm},
    stmt/.style={rectangle, draw=gray!60, fill=gray!5, very thick, minimum size=5mm, yshift=0.7cm},
    decl/.style={rectangle, draw=blue!60, fill=gray!5, very thick, minimum size=5mm, yshift=0.7cm},
    hdecl/.style={rectangle, draw=blue!60, fill=blue!15, very thick, minimum size=5mm, yshift=0.7cm},
    subtree/.style={shape border rotate=90, isosceles triangle, draw=gray!60, fill=gray!5, very thick, minimum size=5mm, yshift=0.0cm},
}
\usepackage{blkarray}
\usepackage{graphicx}
\usepackage{forest} % https://tex.stackexchange.com/questions/198405/how-to-change-the-color-of-subtrees-in-tikz-qtree
% ------------------------------------------------

% Math
\usepackage{amsmath, amsfonts}
\usepackage{amssymb}
\usepackage{proof}
\usepackage{mathrsfs}
% Crossed-out symbols
% https://tex.stackexchange.com/questions/75525/how-to-write-crossed-out-math-in-latex
\usepackage[makeroom]{cancel}
\usepackage{mathtools}
% ------------------------------------------------

% Additional font sizes
% https://www.overleaf.com/learn/latex/Questions/How_do_I_adjust_the_font_size%3F
\usepackage{moresize}
% Additional colors
% https://www.overleaf.com/learn/latex/Using_colours_in_LaTeX
\usepackage{xcolor}
% \texttimes
\usepackage{textcomp}
% ------------------------------------------------

% Language
\usepackage[utf8] {inputenc}
\usepackage[T2A] {fontenc}
\usepackage[english, russian] {babel}
\usepackage{indentfirst, verbatim}
\usetikzlibrary{cd, babel}
% ------------------------------------------------

% Fonts
\usepackage{stmaryrd}
\usepackage{cmbright}
\usepackage{wasysym}
% ------------------------------------------------

% Code
% https://tex.stackexchange.com/questions/99475/how-to-invoke-latex-with-the-shell-escape-flag-in-texstudio-former-texmakerx
% Colored, requires --shell-escape compiling option
\usepackage{minted}
\setminted{xleftmargin=\parindent, autogobble, escapeinside=??, linenos, numberblanklines=false}
\usepackage{listings}
% ------------------------------------------------

% Custom commands
\newcommand{\vocab}[1]{\textbf{#1}} % new word for vocabulary
\newcommand{\point}[1]{{\color{blue}\textit{#1}}} % point out something in text
\newcommand{\sembr}[1]{\llbracket{#1}\rrbracket} % semantic brackets
\newcommand{\positive}{$+$} % item: pros
\newcommand{\negative}{{\color{red} $-$}} % item: cons
\newcommand{\comb}[1]{\mathbf{#1}}
\newcommand{\step}{\rightsquigarrow}
\newcommand{\term}[1]{\mathbf{#1}}
\newcommand{\ap}{~}
\newcommand{\termdef}{\coloneqq}
\newcommand{\subst}[3]{\left[#2 \mapsto #3 \right] #1}
\newcommand{\eqbeta}{=_\beta}
\newcommand{\eqeta}{=_\eta}
\newtheorem{task}{Упражнение}
% ------------------------------------------------

% Head
%\usepackage{fancybox,fancyhdr} not compatible with minted
\usepackage{hyperref}
%\pagestyle{fancy}
% ------------------------------------------------

% Bibliography
\usepackage{csquotes}
% https://tex.stackexchange.com/questions/3802/how-to-get-doi-links-in-bibliography
\usepackage{natbib}
\bibliographystyle{unsrtnat}
%\bibliographystyle{apalike}
%\bibliography{bib}
%\usepackage[backend=bibtex]{biblatex}
%\addbibresource{bib.bib}
%\addbibresource{bib}
% ------------------------------------------------

% Line numbers
% https://tex.stackexchange.com/questions/16010/number-every-line-of-pages
\usepackage{lineno}
\linenumbers
% ------------------------------------------------

% Enumerations
% https://tex.stackexchange.com/questions/10684/vertical-space-in-lists
\usepackage{enumitem}
\setlist{noitemsep} % nosep
\renewcommand{\labelitemi}{$\triangleright$}
\renewcommand{\labelitemii}{$\triangleright$}
\renewcommand{\labelitemiii}{$\triangleright$}
\renewcommand{\labelitemiv}{$\triangleright$}
% ------------------------------------------------

% Formatting
\usepackage{multicol}
% ------------------------------------------------

\begin{document}

    \begin{center}
    {\LARGE ФП 2.0}
        \\
        осень 2024
    \end{center}

    \tableofcontents

    \newpage

    \section*{Введение}

    В функциональном программировании и соответствующем языковом дизайне существует некоторый набор знаний, считающихся общеизвестным фольклором.
    Сложность в том, что эти знания рассеяны по книгам, статьям и ``культовым'' блог-постам, и требуется довольно много времени и сил для восстановления целостной картины.

    Цель этого курса --- собрать в одном месте такие фольклорные знания и организовать их в некоторую систему.
    Курс будет явным образом опираться на классические работы и помогать в их изучении.
    Просмотр упоминаемых статей является важной частью самостоятельной работы в рамках курсе.

    В связи с широтой контекста, этот курс является обзорным и не всегда глубоким.
    Так, детали реализации в GHC или теор-категорные основания вещей могут даваться в общем виде и без конкретики.
    В то же время в плоскости языкового дизайна через оптику функционального программирования и пользовательского опыта на Haskell курс пытается быть максимально подробным.

    Выбор тем и структура курса во многом обусловлены организацией языка Haskell, который этот курс использует как референсный.
    Не в последнюю очередь выбор тем для курса обусловлен интересами его автора.


    \clearpage


    \section{Воспоминания о ФП}

    \input{fp2-remember}

    \clearpage


    \section{Классические интерпретаторы}

    \input{fp2-initial-interpreters}

    \clearpage


    \section{Параметрический полиморфизм}

    \input{fp2-parametric}

    \clearpage


    \section{Специальный (ad-hoc) полиморфизм} \label{sec:ad-hoc}

    \input{fp2-ad-hoc}

    \clearpage


    \section{Продолжения (continuations)} \label{sec:continuations}

    \input{fp2-continuations}

    \clearpage


    \section{Интерпретаторы зазеркалья} \label{sec:wonder-interpreters}

    \input{fp2-wonder-interpreters}

    \clearpage


    \section{Метапрограммирование и специализация}

    % todo newtype derivings & coersions & kotlin delegates

    % todo type data GHC extension & datatype promotion

    % todo deriving via & Kotlin delegates

    % todo split intro several topics

    % todo specilization, deforestation, metaprogramming
    % todo staged programming
    % todo modal types for staged programming
    % todo type roles

    % todo streams and fusion
    % todo CPS

    % todo staged computations and modal types
    % todo Haskell papers about fusion

    % todo fist class specialization to beat type families

    % todo generics and Gibbons paper about abstractions
    % todo SOP & variadics

    % todo ghc inlining paper

    % todo https://ora.ox.ac.uk/objects/uuid:cd041aa0-8d69-4f18-bce2-6d75244b69b9/files/m7fd9779b27fcb70ae734e66bcd3ee79f

    % todo https://ryanglscott.github.io/2018/06/22/quantifiedconstraints-and-the-trouble-with-traversable/

    % todo Oleg's finally tagless partially evaluated paper

    % todo variadics

    % todo Staging with Class

    % todo hygene macro & dynamic scoping

    % todo Derivable type classes paper

    % todo FRP

%    \subsection{Template Haskell}
%
%    % todo порядок на коде для поддержания реификации
%
%    % todo
%
%    \subsection{Рефлексия и реификация}
%
%    % TODO
%
%    \subsection{Zig-generics}
%
%    % todo
%
%    \subsection{GHC.Generics}
%
%    % todo
%
%    \subsection{Uniplate}
%
%    % todo


    \section{Дополнительные главы монад} \label{sec:monads}

    % todo merriage of effects and monads

    % todo ncatlabs

    % todo Monads and algebras

    % todo оригинальная статья

    % todo связь с континуэйшенами

    % todo mother of all monads

    % todo Stackless Scala with free monads

    % todo monadic reflection
    % todo monadic reflection & direct style (lib from scala)

    % todo free monads, freer monads

    % todo монады не композируются, но фримонады - композируются

    % todo semantic domains have monad structure

    % todo https://github.com/lampepfl/monadic-reflection/blob/main/TUTORIAL.md

    % todo C# expression trees
    % todo F# что-то про монады и forM

    % todo call by push value

    % todo monads in pythong with nice syntax

    % todo lazyness
    % todo direct style

    % todo Monads and composable continuations by Phill Wadler

    % todo Representing Monads Filinsky
    % todo paper delimited continuations in WebAssembly

    % todo


    \section{Хендлеры эффектов} \label{sec:effect-handlers}

    % todo monad error is a bullshit

    % todo https://homepages.inf.ed.ac.uk/wadler/papers/expression/expression.txt

    % todo https://www.eff-lang.org/handlers-tutorial.pdf

    % todo алгебраические эффекты
    % todo связь с delimited continuations
    % todo стратегии компиляции, связь с codata
    % todo эффекты высших порядков
    % todo full vs shallow embeddings
    % todo abstracting definitional interpreters & github semantics
    % todo fused effects and CPS

    % todo expression problem

    % todo compare open type families & extensible interpreters

    % todo Polymorphic Symmetric Multiple Dispatch with Variance

    % todo \textit{multimethods}

    % todo  custom schedulers

    Languages with \textit{multimethods}, like Common Lisp’s CLOS, Dylan, and Julia do support adding both new types and operations easily.
    What they typically sacrifice is either static type checking, or separate compilation.

    % todo ZIO, TS Effect


    % todo


    \section{Системы эффектов} \label{sec:effect-systems}

    % todo


    \section{Корутины}

    % todo structured concurrency

    % todo


    \section{Компилятор GHC и runtime}

    % todo Working with Source Plugins paper

    % todo \href{https://gitlab.haskell.org/ghc/ghc/-/wikis/commentary/compiler/generated-code}{\color{blue} I know kung fu: learning STG by example}

    % todo


    \section{Оптика}

    % todo there are pierce lenses

    % todo http://www.timphilipwilliams.com/posts/2019-07-25-minecraft.html

    % todo profunctor optics
    % todo van laarhoven CPS optics

    % todo


    % todo куда-нибудь запихнуть algebra driven design, quick check и доклад про проперти-тесты
    % todo expression problem somewhere
    % todo где-то должно быть содержание книжки про типы Sandy Maguire, data families
    % todo Perhaps Not The Answer You Were Expecting But You Asked For It
    % todo link to SICP

    % todo сказать где-нибудь про вариантность и изоморфизм

    % todo вставить куда-нибудь ссылку на F for Functor

    % todo зависимые типы в Haskell

    % todo где-то нужно про систему кайндов, константы, полиморфизм... Походу Haskell types 101.

    % todo рассовать упражнений по конспекту

    % todo inner and outer iteration - The essence of the iterator pattern

    % todo call-by-push value and how it is related to effects

    % todo Higher-Order Type-Level Programming in Haskell

    % todo как полиморфные кайнды связаны с levity-полиморфизмом

    % todo type families & saturation




    \begin{center}
        \vspace{2em}
        \textit{\LARGE To be continued...}
        \vspace{2em}
    \end{center}


    % todo что-то сделать с порядком
    \newpage
    \bibliography{bib}

\end{document}
